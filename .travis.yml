language: python
python:
- '2.7'
before_install:
- wget http://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -O miniconda.sh
- chmod +x miniconda.sh
- ./miniconda.sh -b
- export PATH=/home/travis/miniconda/bin:$PATH
- conda update --yes conda
install:
- conda install --name environment --yes python=$TRAVIS_PYTHON_VERSION atlas numpy scipy matplotlib nose dateutil pandas statsmodels
- source activate environment
- pip install -r requirements.txt
- pip install -r test_requirements.txt
- pip install -e src/scraper src/server src/common src/topicmodeller
- pip install coveralls
before_script:
- mkdir lib
- wget http://storage.googleapis.com/appengine-sdks/featured/google_appengine_1.9.23.zip -nv
- unzip -q google_appengine_1.9.23.zip -d lib
- ./lib/google_appengine/dev_appserver.py ./src/server/server/ --skip_sdk_update_check &
- sleep 3
script:
- py.test src
- coverage run --source=src --omit=*tests* -m py.test src
  #NB: when you change this, you must also change command in tools/run_pylint.py
- pylint src/server/server src/scraper/scraper/ src/common/common src/topicmodeller src/topicmodeller/topicmodeller
- pylint --rcfile=pylintrc_tests src/server/tests/*.py src/scraper/tests/*.py src/common/tests/*.py src/functests/*.py src/topicmodeller/tests/*.py
# NB: this pylint command with *.py is not resilient for nested directories, if we need it we might
# check https://gist.github.com/gregorynicholas/3152237.
after_success:
- coveralls
- if [[ ("${TRAVIS_BRANCH}" = "master") &&  ("${TRAVIS_PULL_REQUEST}" = "false") ]]; then ./lib/google_appengine/appcfg.py -A gator-01 --skip_sdk_update_check --oauth2_access_token=$GAE_TOKEN --oauth2_refresh_token=$GAE_REFRESH_TOKEN update ./src/server/server; fi

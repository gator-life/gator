language: python
addons:
  apt:
    packages:
      - oracle-java8-set-default
cache: pip
services:
  - docker
python:
- '2.7'
before_install:
# Install git-lfs. https://github.com/travis-ci/travis-ci/issues/3634
- mkdir -p $HOME/bin
- wget https://github.com/github/git-lfs/releases/download/v1.4.1/git-lfs-linux-amd64-1.4.1.tar.gz
- tar xvfz git-lfs-linux-amd64-1.4.1.tar.gz
- mv git-lfs-1.4.1/git-lfs $HOME/bin/git-lfs
- export PATH=$PATH:$HOME/bin/
- git lfs install
# GCloud key. Generated by instructions at https://docs.travis-ci.com/user/deployment/google-app-engine
# and https://cloud.google.com/solutions/continuous-delivery-with-travis-ci
- openssl aes-256-cbc -K $encrypted_411bc28b64b2_key -iv $encrypted_411bc28b64b2_iv
  -in client-secret.json.enc -out client-secret.json -d
#Â https://cloud.google.com/solutions/continuous-delivery-with-travis-ci#continuous_deployment_on_app_engine_flexible_environment_instances
- ssh-keygen -q -N "" -f ~/.ssh/google_compute_engine
install:
- tools/install_envs.sh
- gcloud auth activate-service-account --key-file client-secret.json
- gcloud config set project gator-01
# https://cloud.google.com/compute/docs/gcloud-compute/#default-properties
- gcloud config set compute/zone us-central1-f
- pip install coveralls
script:
- ./tools/start_tests.sh
- python tools/run_pylint.py src
- ./tools/start_tests.sh cover
after_success:
- coveralls
deploy:
  provider: script
  skip_cleanup: true
  script: tools/deploy_all.sh
  on:
    branch: master
